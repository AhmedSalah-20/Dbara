<!-- templates/admin/dashboard.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Dbara{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Lien vers l'ancien admin -->
    <div class="text-end mb-4">
        <a href="/admin/" class="btn btn-outline-secondary btn-sm">
            Go to Classic Django Admin
        </a>
    </div>

    <h1 class="display-4 fw-bold text-center mb-5 text-warning">Admin Dashboard</h1>

    <!-- Statistiques Utilisateurs (5 cartes alignÃ©es) -->
    <div class="row g-4 mb-5 text-center">
        <div class="col-md">
            <div class="card bg-primary text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_users }}</h2>
                    <p class="fs-4 mb-0">Total Users</p>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-dark text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_admins }}</h2>
                    <p class="fs-4 mb-0">Administrators</p>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-info text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_visitors }}</h2>
                    <p class="fs-4 mb-0">Visitors</p>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-success text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_chefs }}</h2>
                    <p class="fs-4 mb-0">Chefs</p>
                </div>
            </div>
        </div>
        <div class="col-md">
            <div class="card bg-warning text-dark shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_nutritionists }}</h2>
                    <p class="fs-4 mb-0">Nutritionists</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques Recettes -->
    <div class="row g-4 mb-5 text-center">
        <div class="col-md-4">
            <div class="card bg-dark text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_recipes }}</h2>
                    <p class="fs-4 mb-0">Total Recipes</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ approved_recipes }}</h2>
                    <p class="fs-4 mb-0">Approved</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-danger text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ pending_recipes }}</h2>
                    <p class="fs-4 mb-0">Pending Approval</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Autres stats rapides -->
    <div class="row g-4 mb-5 text-center">
        <div class="col-md-6">
            <div class="card bg-purple text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_analyses }}</h2>
                    <p class="fs-4 mb-0">Nutritional Analyses</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-orange text-white shadow-lg hover-lift">
                <div class="card-body p-4">
                    <h2 class="display-5 fw-bold">{{ total_comments }}</h2>
                    <p class="fs-4 mb-0">Total Comments</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Users & Pending Recipes -->
    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h5>Recent Users</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for item in display_users %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ item.user.username }}</strong>
                                <span class="badge bg-secondary ms-2">{{ item.display_role }}</span>
                            </div>
                            <small class="text-muted">{{ item.user.date_joined|date:"d M Y" }}</small>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-muted">No users yet</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-dark">
                    <h5>Recipes Pending Approval ({{ pending_recipes }})</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for recipe in pending_approval %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ recipe.title }}</strong><br>
                                <small class="text-muted">by {{ recipe.author.username }}</small>
                            </div>
                            <a href="{% url 'admin:accounts_recipe_change' recipe.pk %}" class="btn btn-sm btn-outline-primary">
                                Review
                            </a>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-success fw-bold">All recipes approved! ðŸŽ‰</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ModÃ©ration des commentaires -->
    <div class="card shadow-lg border-0 mb-5">
        <div class="card-header bg-danger text-white">
            <h5>Recent Comments (Moderation)</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th>User</th>
                            <th>Recipe</th>
                            <th>Comment</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comment in recent_comments %}
                        <tr>
                            <td><strong>{{ comment.author.username }}</strong></td>
                            <td>
                                <a href="{% url 'accounts:recipe_detail' comment.recipe.pk %}">
                                    {{ comment.recipe.title }}
                                </a>
                            </td>
                            <td>{{ comment.content|truncatewords:15 }}</td>
                            <td>{{ comment.created_at|date:"d M H:i" }}</td>
                            <td>
                                <form method="POST" action="{% url 'accounts:admin_delete_comment' comment.pk %}" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this comment permanently?')">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">No comments yet</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .hover-lift:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15) !important;
    }
    .bg-purple { background: linear-gradient(135deg, #6a11cb, #2575fc); }
    .bg-orange { background: linear-gradient(135deg, #ff7e5f, #feb47b); }
</style>
{% endblock %}