<!-- templates/accounts/signup.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Join Dbara - Create Account{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-header bg-black text-warning text-center py-4 rounded-top">
                    <h2 class="mb-0 fw-bold">ğŸ‡¹ğŸ‡³ CrÃ©ez votre compte Dbara</h2>
                    <p class="mb-0 opacity-75">Rejoignez la communautÃ© des saveurs tunisiennes authentiques</p>
                </div>
                
                <div class="card-body p-5">
                    <!-- Messages Django -->
                    {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- Formulaire unique et propre -->
                    <form method="POST" enctype="multipart/form-data" id="signupForm" novalidate>
                        {% csrf_token %}

                        <!-- 1. Informations de base -->
                        <h5 class="fw-bold text-dark mb-4 border-bottom pb-2">ğŸ‘¤ Informations personnelles</h5>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold">Nom d'utilisateur</label>
                                <input type="text" name="username" class="form-control form-control-lg" 
                                       placeholder="Ex: ahmed_kamoun" maxlength="150" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold">Email</label>
                                <input type="email" name="email" class="form-control form-control-lg" 
                                       placeholder="votre@email.com" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold">Mot de passe</label>
                                <input type="password" name="password1" class="form-control form-control-lg" 
                                       placeholder="Minimum 8 caractÃ¨res" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold">Confirmer le mot de passe</label>
                                <input type="password" name="password2" class="form-control form-control-lg" required>
                            </div>
                        </div>

                        <!-- 2. Photo de profil (tous les rÃ´les) -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">ğŸ“¸ Photo de profil (optionnel)</label>
                            <input type="file" name="profile_picture" class="form-control form-control-lg" 
                                   accept="image/*">
                            <small class="text-muted">Ajoutez une photo pour personnaliser votre profil</small>
                        </div>

                        <!-- 3. SÃ©lection du rÃ´le -->
                        <div class="mb-5">
                            <label class="form-label fw-bold fs-5">ğŸ­ Je m'inscris en tant que</label>
                            <select name="role" class="form-select form-select-lg" id="roleSelect" required>
                                <option value="" disabled selected>-- Choisissez votre rÃ´le --</option>
                                <option value="visitor">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Visiteur (accÃ¨s immÃ©diat)</option>
                                <option value="chef">ğŸ‘¨â€ğŸ³ Chef (validation admin requise)</option>
                                <option value="nutritionist">ğŸ’Š Nutritionniste (validation admin requise)</option>
                            </select>
                        </div>

                        <!-- 4. Champs professionnels (conditionnels) -->
                        <div id="professionalFields" style="display: none;">
                            <h5 class="fw-bold text-primary mb-4 border-bottom pb-2">ğŸ† Informations professionnelles</h5>
                            
                            <div class="alert alert-info border-0">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>âš ï¸ Important :</strong> Les comptes professionnels nÃ©cessitent une validation admin. 
                                Vous recevrez un email lors de l'activation.
                            </div>

                            <!-- DiplÃ´me/Certificat -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">ğŸ“œ DiplÃ´me / Certificat (obligatoire)</label>
                                <input type="file" name="certificate" class="form-control form-control-lg" 
                                       accept=".pdf,image/*" required>
                                <small class="text-muted">PDF ou image pour vÃ©rification admin</small>
                            </div>

                            <!-- SpÃ©cialitÃ© (chefs uniquement) -->
                            <div class="mb-4" id="specialityField" style="display: none;">
                                <label class="form-label fw-bold">ğŸŒŸ SpÃ©cialitÃ© culinaire</label>
                                <select name="speciality" class="form-select form-control-lg">
                                    <option value="">-- Choisissez votre spÃ©cialitÃ© --</option>
                                    <option value="traditional">ğŸ‡¹ğŸ‡³ Cuisine traditionnelle tunisienne</option>
                                    <option value="seafood">ğŸŸ Fruits de mer & Poisson</option>
                                    <option value="pastry">ğŸ® PÃ¢tisserie & Desserts</option>
                                    <option value="grill">ğŸ”¥ Grillades & BBQ</option>
                                    <option value="vegetarian">ğŸ¥— VÃ©gÃ©tarien & Sain</option>
                                    <option value="fusion">âœ¨ Fusion moderne</option>
                                    <option value="other">Autres spÃ©cialitÃ©s</option>
                                </select>
                            </div>

                            <!-- RÃ©gion -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">ğŸ“ RÃ©gion</label>
                                <select name="region" class="form-select form-control-lg" required>
                                    <option value="">-- SÃ©lectionnez votre rÃ©gion --</option>
                                    <option value="tunis">ğŸ™ï¸ Tunis</option>
                                    <option value="ariana">ğŸŒ¿ Ariana</option>
                                    <option value="sfax">âš“ Sfax</option>
                                    <option value="sousse">ğŸ–ï¸ Sousse</option>
                                    <option value="monastir">ğŸ•Œ Monastir</option>
                                    <option value="bizerte">âš“ Bizerte</option>
                                    <option value="nabeul">ğŸŠ Nabeul</option>
                                    <option value="other">Autres rÃ©gions</option>
                                </select>
                            </div>

                            <!-- AnnÃ©es d'expÃ©rience -->
                            <div class="mb-4">
                                <label class="form-label fw-bold">â³ AnnÃ©es d'expÃ©rience</label>
                                <input type="number" name="years_experience" class="form-control form-control-lg" 
                                       min="0" max="50" placeholder="0">
                            </div>

                            <!-- Bio professionnelle -->
                            <div class="mb-5">
                                <label class="form-label fw-bold">âœï¸ Petite bio professionnelle</label>
                                <textarea name="bio" class="form-control" rows="4" 
                                          placeholder="Parlez-nous de votre parcours professionnel... 
Ex: 'Chef spÃ©cialisÃ© en cuisine tunisienne traditionnelle depuis 15 ans...'"></textarea>
                                <small class="text-muted">Maximum 500 caractÃ¨res recommandÃ©</small>
                            </div>
                        </div>

                        <!-- 5. Boutons d'action -->
                        <div class="text-center mt-5">
                            <button type="submit" class="btn btn-yellow btn-lg px-5 py-3 fw-bold shadow-lg" id="submitBtn">
                                <i class="bi bi-check-circle me-2"></i>CrÃ©er mon compte Dbara
                            </button>
                        </div>

                        <div class="text-center mt-4">
                            <p class="text-muted mb-0">
                                DÃ©jÃ  un compte ? 
                                <a href="{% url 'accounts:login' %}" class="text-warning fw-bold text-decoration-none">
                                    <i class="bi bi-box-arrow-in-right me-1"></i>Se connecter
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript optimisÃ© (1 seule fonction) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('roleSelect');
    const professionalFields = document.getElementById('professionalFields');
    const specialityField = document.getElementById('specialityField');

    function toggleProfessionalFields() {
        const role = roleSelect.value;
        const showProfessional = role === 'chef' || role === 'nutritionist';
        
        professionalFields.style.display = showProfessional ? 'block' : 'none';
        
        if (showProfessional) {
            specialityField.style.display = role === 'chef' ? 'block' : 'none';
        }
    }

    // Ã‰couteur d'Ã©vÃ©nement
    roleSelect.addEventListener('change', toggleProfessionalFields);
    
    // Initialisation
    toggleProfessionalFields();

    // Validation client-side
    document.getElementById('signupForm').addEventListener('submit', function(e) {
        const password1 = document.querySelector('input[name="password1"]').value;
        const password2 = document.querySelector('input[name="password2"]').value;
        
        if (password1 !== password2) {
            e.preventDefault();
            alert('âŒ Les mots de passe ne correspondent pas !');
            return false;
        }
    });
});
</script>
{% endblock %}