<!-- templates/nutritionist/chatbot.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Chatbot SantÃ© IA - Dr. {{ user.username }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="text-center display-5 fw-bold text-info mb-4">
                ğŸ¤– Chatbot SantÃ© IA - Dr. {{ user.username }}
            </h1>

            <!-- Zone de conversation -->
            <div class="card shadow-lg mb-4" style="height: 60vh; overflow-y: auto; background: #f8f9fa;">
                <div class="card-body p-4">
                    {% if not chat_history %}
                        <p class="text-center text-muted mt-5 fs-5">
                            <em>DÃ©marrez la conversation ! Posez une question nutrition ğŸ½ï¸</em><br><br>
                            Exemples :<br>
                            â€¢ Combien de calories dans un couscous au poisson ?<br>
                            â€¢ Le lablabi est-il bon pour la santÃ© ?<br>
                            â€¢ ÙƒÙŠÙØ§Ø´ Ù†Ø¬Ù… Ù†Ù‚Ù„Ù„ Ø§Ù„Ù…Ù„Ø­ ÙÙŠ Ø§Ù„Ø´Ø®Ø´ÙˆØ®Ø©ØŸ
                        </p>
                    {% endif %}

                    {% for msg in chat_history %}
                        <!-- Message utilisateur -->
                        <div class="text-end mb-4">
                            <div class="bg-primary text-white p-3 rounded-3 d-inline-block" style="max-width: 80%;">
                                {{ msg.user }}
                            </div>
                        </div>

                        <!-- RÃ©ponse du bot -->
                        <div class="text-start mb-4">
                            <div class="bg-success text-white p-3 rounded-3 d-inline-block" style="max-width: 80%;">
                                <strong>ğŸ¤– Dr. {{ user.username }} :</strong><br>
                                {{ msg.bot|linebreaks }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Formulaire d'envoi -->
            <form method="POST" class="d-flex gap-2">
                {% csrf_token %}
                <input type="text" name="message" class="form-control form-control-lg" 
                       placeholder="Posez votre question nutrition..." required autocomplete="off">
                <button type="submit" class="btn btn-info btn-lg px-5">Envoyer</button>
            </form>

            <div class="text-center mt-3">
                <small class="text-muted">PropulsÃ© par Google Gemini â€¢ RÃ©ponses instantanÃ©es & prÃ©cises âœ¨</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}