<!-- templates/base/home.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Welcome to Dbara - Authentic Tunisian Recipes & Health Advice{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Hero Section -->
    <div class="text-center mb-5 p-5 rounded-4 shadow-lg text-white"
         style="background: linear-gradient(135deg, #11998e, #38ef7d);">
        <h1 class="display-3 fw-bold mb-4">
            Welcome to <span style="color:#ffd700;">Dbara</span> ðŸ¥—ðŸ‡¹ðŸ‡³
        </h1>
        <p class="lead fs-2 mb-4">Discover authentic Tunisian recipes with professional nutritional analysis</p>
        
        <!-- Bouton "Ask a Question" â€“ visible SEULEMENT pour les Visiteurs (connectÃ©s ou non) -->
        {% if not user.is_authenticated or user.userprofile.role == 'visitor' %}
            <a href="{% url 'accounts:public_chatbot' %}" class="btn btn-warning btn-lg fw-bold px-5 py-3 shadow">
    ðŸ¤– Ask a Question
</a>
            <p class="mt-3 text-light opacity-75">
                Get instant advice from our Health AI Chatbot â€“ powered by nutrition experts!
            </p>
        {% endif %}
    </div>

    <!-- Recent Chefs -->
    <div class="my-5">
        <h2 class="text-center display-5 fw-bold mb-4" style="color:#ffd700;">Our Latest Chefs ðŸ”¥</h2>
        <div class="row g-4 justify-content-center">
            {% for profile in recent_chefs %}
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-lg h-100 hover-lift border-0">
                    <div class="card-body text-center">
                        {% if profile.profile_picture %}
                            <img src="{{ profile.profile_picture.url }}" class="rounded-circle mb-3" width="120" height="120" alt="{{ profile.user.username }}">
                        {% else %}
                            <img src="{% static 'images/default-chef.jpg' %}" class="rounded-circle mb-3" width="120" height="120" alt="Chef">
                        {% endif %}
                        <h5 class="fw-bold">Chef {{ profile.user.username }}</h5>
                        <p class="text-muted">{{ profile.recipe_count }} recipe{{ profile.recipe_count|pluralize }}</p>
                        <a href="{% url 'accounts:chef_profile_detail' profile.user.username %}" class="btn btn-outline-warning btn-sm">
                            View Profile
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="text-center text-muted">No chefs yet. Be the first!</p>
            {% endfor %}
        </div>
    </div>

    <!-- Popular Recipes -->
    <div class="my-5">
        <h2 class="text-center display-5 fw-bold mb-4" style="color:#38ef7d;">Popular Recipes ðŸ¥˜</h2>
        <div class="row g-4">
            {% for recipe in popular_recipes %}
            <div class="col-md-6 col-lg-4">
                <div class="card shadow-lg h-100 hover-lift border-0">
                    {% if recipe.images.first %}
                        <img src="{{ recipe.images.first.image.url }}" class="card-img-top" style="height:220px; object-fit:cover;" alt="{{ recipe.title }}">
                    {% else %}
                        <img src="{% static 'images/default-recipe.jpg' %}" class="card-img-top" style="height:220px; object-fit:cover;" alt="{{ recipe.title }}">
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold">{{ recipe.title }}</h5>
                        <p class="text-muted small">By Chef {{ recipe.author.username }}</p>
                        <div class="mt-auto">
                            <a href="{% url 'accounts:recipe_detail' recipe.pk %}" class="btn btn-success w-100">
                                View Recipe
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="text-center text-muted">No recipes yet. Coming soon!</p>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .hover-lift:hover {
        transform: translateY(-10px);
        transition: 0.4s;
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
</style>
{% endblock %}